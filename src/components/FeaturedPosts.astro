---
import { Badge, Card, Heading, Link } from 'accessible-astro-components'
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content'
import { slugify } from '@/utils/slugify'


// Import images directly for optimization
import postImage1 from '@assets/images/posts/post-image-1.png'
import postImage2 from '@assets/images/posts/post-image-2.png'
import postImage3 from '@assets/images/posts/post-image-3.png'

/**
 * FeaturedPosts Component
 *
 * @description A component that displays featured blog posts from JSONPlaceholder API
 */
interface Props {
  /**
   * Additional classes to apply to the section
   */
  class?: string
  /**
   * The number of posts to display
   * @default 3
   */
  limit?: number
  /**
   * The title for the section
   * @default "Latest posts"
   */
  title?: string
}

interface Post {
  id: number
  userId: number
  title: string
  body: string
  featuredImage: any
  shortUrl: string
}

const { class: className, limit = 3, title = 'Latest posts' } = Astro.props

// Fetch posts from API
const posts = await getCollection('posts')


// Truncate body to first 40 words
function truncateBody(body: string, wordCount = 40): string {
  const words = body.split(/\s+/)
  return words.slice(0, wordCount).join(' ') + (words.length > wordCount ? 'â€¦' : '')
}
// Function to truncate title for better display
function truncateTitle(title: string): string {
    const words = title ? title.split(' ') : []
  const truncated = words.slice(0, 4).join(' ')
  return truncated
}


const featuredPosts = posts.slice(0, limit)



---

<section class:list={[className, 'my-64']}>
  <div class="container">
    <Heading level="h2" class="mb-6">{title}</Heading>
    <div class="grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3">
      {
        featuredPosts.map((post) => (
          <Card
            url={'/blog/' + post.slug}
            headingLevel="h2"
            title={post.data.title}
          >
            {truncateBody(post.body)}
            {post.data.tags && (
              <div class="mt-4 flex flex-wrap gap-2">
                {post.data.tags.map((tag: string) => (
                  <Badge>{tag}</Badge>
                ))}
                </div>
                )}
          </Card>
        ))
      }
    </div>
    <div class="mt-12">
      <Link href="/blog/" isButton animateOnHover animationType="nudge">
        Read all posts
        <Icon aria-hidden="true" name="lucide:arrow-right" size="1.5rem" />
      </Link>
    </div>
  </div>
</section>
